{% extends "web_ui/base.html" %}
{% load static %}
{% block title %}Publish core{% endblock %}
{% block meta_description %}Publish a FuseSoC core directly from a GitHub repository. Select a version, validate, and publish your open source hardware core.{% endblock %}
{% block og_title %}Publish core | FuseSoC Package Directory{% endblock %}
{% block og_description %}Publish a FuseSoC core directly from a GitHub repository. Select a version, validate, and publish your open source hardware core.{% endblock %}
{% block extra_head %}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Publish core | FuseSoC Package Directory",
      "description": "Publish a FuseSoC core directly from a GitHub repository. Select a version, validate, and publish your open source hardware core.",
      "url": "{{ request.build_absolute_uri }}",
      "isPartOf": {
        "@type": "WebSite",
        "name": "FuseSoC Package Directory",
        "url": "{{ request.scheme }}://{{ request.get_host }}{% url 'landing' %}"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "{{ request.scheme }}://{{ request.get_host }}{% url 'landing' %}"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Publish core",
          "item": "{{ request.build_absolute_uri }}"
        }
      ]
    }
    </script>
    <script src="{% static 'js/expandable_section.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <style>
        label { display: block; margin-top: 1em; }
        .hidden { display: none; }
        #result { margin-top: 2em; }
    </style>
{% endblock %}
{% block content %}
    <!-- Hidden card header template for JS use -->
    <div id="card-header-template" style="display:none;">
        {% include "web_ui/includes/card_header.html" with icon="bi __ICON__" title="__TITLE__" %}
    </div>

    <div class="card shadow-sm mb-4">
        {% include "web_ui/includes/card_header.html" with icon="bi bi-cloud-plus" title="Publish new core" %}
        <div class="card-body">

            <!-- Instructions (collapsible) -->
            <div class="section-card collapsible" data-collapsed="true">
                <div class="section-header">
                    <button type="button" class="expand-toggle btn btn-link p-0 me-2" aria-label="Expand/collapse library">
                        <i class="bi bi-plus"></i>
                    </button>
                    <h2 class="h5">How to publish a FuseSoC Core</h2>
                </div>
                <div class="section-content">
                    <p>
                        Use this page to publish a FuseSoC core directly from a GitHub repository.<br>
                        You can select the latest commit, a specific tag, or enter a commit hash to target a particular version.
                        Only <code>.core</code> files located in the root of the repository are supported.
                    </p>
                    <ol>
                        <li>Enter a GitHub repo URL and select a version (latest, tag, or commit).</li>
                        <li>Parse to list available <code>.core</code> files.</li>
                        <li>Select the core you like to publish, validate it, and then publish.</li>
                    </ol>
                    <p>
                        Make sure the repository you specify actually contains the local core with its source files - not just a core description file that points to another provider.
                        External cores already containing a <code>provider</code> section cannot be published here; use the <a href="{% url 'core_directory:api_docs_landing' %}" target="_blank">API</a> in those cases.
                    </p>
                    <p>
                        <strong>Note:</strong> When publishing using this web interface, the core will automatically be converted into a remote core. A <code>provider</code> section will be added to the core, referencing the selected GitHub commit by its SHA.
                    </p>
                    <p>
                        <strong>Core signing is not supported:</strong> This web interface does not currently support signing of published cores or publishing of existing signatures.
                    </p>
                </div>
            </div>

            <!-- Repository selection form -->
            <div class="section-card">
                <h2 class="section-header">
                    <i class="bi bi-shop me-2"></i>
                    Select GitHub repository
                </h2>
                <div class="section-content" style="display:block;">
                    <form id="repo-form" autocomplete="off" class="row g-2 align-items-center">
                        <div class="col-auto">
                            <label for="repo_url" class="visually-hidden">GitHub Repository URL</label>
                            <input type="url" id="repo_url" name="repo_url" class="form-control" style="min-width:350px; width:400px;" required placeholder="https://github.com/owner/repo">
                        </div>
                        <div class="col-auto">
                            <label for="version_type" class="visually-hidden">Version Type</label>
                            <select id="version_type" name="version_type" class="form-select" required>
                                <option value="latest">Latest</option>
                                <option value="tag">Tag</option>
                                <option value="commit">Commit</option>
                            </select>
                        </div>
                        <div class="col-auto" id="tag-field" style="display:none;">
                            <label for="tag" class="visually-hidden">Tag</label>
                            <select id="tag" name="tag" class="form-select"></select>
                        </div>
                        <div class="col-auto" id="commit-field" style="display:none;">
                            <label for="commit" class="visually-hidden">Commit Hash</label>
                            <input type="text" id="commit" name="commit" class="form-control" placeholder="e.g. 1a2b3c4d">
                        </div>
                        <div class="col-auto">
                            <button type="submit" class="btn btn-primary">Parse</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Results and core selection (rendered by JS) -->
            <div id="result"></div>

        </div>
    </div>

    <script src="{% static 'js/publish_core_from_github.js' %}"></script>
{% endblock %}